(()=>{"use strict";const e=(()=>{function e(e){let t;try{t=window[e];const n="__storage_test__";return t.setItem(n,n),t.removeItem(n),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}}return{session:(()=>{let n=JSON.parse(sessionStorage.getItem("orderItemList"))||[];const s=e=>{n=e,e&&e.length>0?sessionStorage.setItem("orderItemList",JSON.stringify(e)):sessionStorage.setItem("orderItemList",JSON.stringify([]))};return{addOrderItem:t=>{e("sessionStorage")&&(n.push(t.outerHTML),s(n))},removeOrderItem:t=>{if(e("sessionStorage")){const e=n.filter((e=>{const n=e.match(/data-menu-item="([^"]+)"/)[1];if(t!=n)return e}));s(e)}},removeAllOrderItems:()=>{n=[],s()},loadOrderItemList:()=>{if(e("sessionStorage")&&null!=n&&n!=[])for(let e of n){const n=document.createElement("div");n.innerHTML=e,t.orderAside.loadOrder(n.firstChild,!0)}}}})()}})(),t=(()=>{const t=document.querySelector(".content"),n=(e,t,n)=>{const s=Array.from(e);s.forEach((e=>e.addEventListener("click",(()=>{s.forEach((e=>e.classList.remove(t))),e.classList.add(t),void 0!==n&&n(e)}))))},s=e=>{for(;e.lastChild;)e.lastChild.remove()},a=e=>{const t=document.createElement("div");return t.classList.add(e),t},r=()=>{const e=e=>{if(void 0===e){e=JSON.parse(sessionStorage.getItem("tableId"))||"not selected"}document.querySelector(".table-selection").innerText=e,document.querySelector(".table-order").innerText=e,sessionStorage.setItem("tableId",e)},r=a=>{s(l),l.innerHTML=`<div class="table">\n                <img class="restaurant-table table-${++a}" src="./images/table.svg" alt="Image of a restaurant table">\n                <p class="restaurant-text">T${a}</p>\n            </div>\n            <div class="table">\n                <img class="restaurant-table table-${++a}" src="./images/table.svg" alt="Image of a restaurant table">\n                <p class="restaurant-text">T${a}</p>\n            </div>\n            <div class="table">\n                <img class="restaurant-table table-${++a}" src="./images/table.svg" alt="Image of a restaurant table">\n                <p class="restaurant-text">T${a}</p>\n            </div>\n            <div class="table">\n                <img class="restaurant-table table-${++a}" src="./images/table.svg" alt="Image of a restaurant table">\n                <p class="restaurant-text">T${a}</p>\n            </div>\n            <div class="table">\n                <img class="restaurant-table table-${++a}" src="./images/table.svg" alt="Image of a restaurant table">\n                <p class="restaurant-text">T${a}</p>\n            </div>\n            <div class="table">\n                <img class="restaurant-table table-${++a}" src="./images/table.svg" alt="Image of a restaurant table">\n                <p class="restaurant-text">T${a}</p>\n            </div>`,t.appendChild(l),o(),n(document.querySelectorAll(".restaurant-table"),"table-clicked",(t=>{const n=t.classList[1].split("-")[1];e(n)}))},o=n=>{s(c),c.innerHTML='<div class="order-icons">\n                <img class="table-image" src="./images/small table icon.svg" alt="">\n                <p class="table-text">TABLE:</p>\n                <p class="table-count table-selection"></p>\n            </div>\n            <button id="selection-btn">SELECT AND CONTINUE</button>',t.appendChild(c),e(n),i()},i=()=>{document.getElementById("selection-btn").addEventListener("click",(()=>{"not selected"!=document.querySelector(".table-selection").innerText?document.getElementById("MENU").click():alert("Select a table.")}))};s(t);const d=a("name-top");d.innerHTML='<p>TABLE LIST</p>\n            <div class="buttons">\n            <button class="floor-btn floor-1 floor-btn-clicked">First Floor</button>\n            <button class="floor-btn floor-2">Second Floor</button>\n            </div>',t.appendChild(d),n(document.querySelectorAll(".floor-btn"),"floor-btn-clicked",(e=>{const t=e.classList.contains("floor-1")?0:6;r(t)}));const l=a("tables"),c=a("selection");r(0)},o=(e,t,n,s,a)=>({name:e.toUpperCase(),category:t,spiciness:n,imgLink:s,price:a}),i={STARTER:{item1:o("chicken wings","N",2,"./images/chickenWing.jpg",23),item2:o("french fries","G",0,"./images/frenchFry.jpg",23),item3:o("glass meat","G",2,"./images/glassMeat.jpg",23),item4:o("glass meat","G",1,"./images/idkBread.jpg",23),item5:o("summer salad","N",1,"./images/summerSalad.jpg",23),item7:o("summer salad","0%",1,"./images/summerSalad.jpg",23),item6:o("chicken wings","G",2,"./images/idkBread.jpg",19)},"MAIN COURSE":{item8:o("summer salad","N",1,"./images/summerSalad.jpg",23),item9:o("summer salad","0%",1,"./images/summerSalad.jpg",23),item10:o("chicken wings","G",2,"./images/idkBread.jpg",23)},DRINKS:{item11:o("bread","G",2,"./images/ikBread.jpg",23),item12:o("glass meat","G",2,"./images/glassMeat.jpg",23),item13:o("summer salad","N",1,"./images/summerSalad.jpg",23),item14:o("summer salad","0%",1,"./images/summerSalad.jpg",23),item15:o("chicken wings","G",2,"./images/idkBread.jpg",23)},DESSERTS:{item8:o("glass meat","G",2,"./images/glassMeat.jpg",23),item9:o("glass meat","G",1,"./images/idkBread.jpg",23),item3:o("summer salad","N",1,"./images/summerSalad.jpg",23),item4:o("summer salad","0%",1,"./images/summerSalad.jpg",23)}},d=()=>{const e=(e="STARTER")=>{const t=i[e];for(let n in t){const s=a("food-item-container"),o=t[n];let i="";for(let e=0;e<o.spiciness;e++)i+='<img src="./images/chilli.svg">';s.innerHTML=`<div class="food-card" data-menu-list="${e}" data-menu-item="${n}">\n                        <div class="food-img">\n                            <img src="${o.imgLink}">\n                        </div>\n                        <div class="food-info">\n                            <p class="food-name">${o.name}</p>\n                            <div class="food-category-container">\n                                <p class="food-category-text">CATEGORY:</p>\n                                <div class="food-category-icons">${o.category}\n                                    <div>\n                                        ${i}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>`,r.appendChild(s)}document.querySelectorAll(".food-card").forEach((e=>{e.addEventListener("click",(()=>l.loadOrder(e,!1)))}))},r=a("food-content");t.appendChild(r),e();const o=a("food-footer");t.appendChild(o),(()=>{const t=["STARTER","MAIN COURSE","DRINKS","DESSERTS"];for(let e in t){const n=document.createElement("button");n.classList.add("food-footer-btn"),"STARTER"===t[e]&&n.classList.add("food-footer-btn-active"),n.innerText=t[e],o.appendChild(n)}n(document.querySelectorAll(".food-footer-btn"),"food-footer-btn-active",(t=>{s(r),e(t.innerText)}))})()},l=(()=>{const t=document.querySelector(".order-content"),n=a("order-content-items"),r=a("order-content-price");let o={},d=0;return{loadOrder:(l,m)=>{const u=i[l.dataset.menuList][l.dataset.menuItem],g=l.dataset.menuItem,p=u.name,v=u.price,b=u.imgLink;m||e.session.addOrderItem(l),document.querySelector(".order-content-empty")&&(s(t),t.appendChild(n),t.appendChild(r));const f=()=>{const a=+(.1*d).toFixed(2);r.innerHTML=`\n                <div class="order-content-price-info">\n                    <div>\n                        <p class="order-content-price-info-text">SUBTOTAL</p>\n                        <p class="order-content-price-info-text">${d}</p>\n                    </div>\n                    <div>\n                        <p class="order-content-price-info-text">SERVICE CHARGE <span class="order-content-price-info-surcharge">10%</span></p>\n                        <p class="order-content-price-info-text">${a}</p>\n                    </div>\n                </div>\n                <div class="order-content-price-interact">\n                    <div class="order-content-price-interact-info">\n                        <p class="order-content-price-interact-info-text">TOTAL</p>\n                        <p class="order-content-price-interact-info-text">${d+a}</p>\n                    </div>\n                    <div class="order-content-price-interact-buttons">\n                        <button class="order-cancel">CANCEL ORDER</button>\n                        <button class="order-send">SEND ORDER</button>\n                    </div>\n                </div>\n                `,document.querySelector(".order-cancel").addEventListener("click",(()=>{s(t),s(n),s(r),d=0,o={},c.orderEmpty(),console.log("cleared"),e.session.removeAllOrderItems()}))};o[g]?(o[g]++,d+=v,document.querySelector(`[data-id=${l.dataset.menuItem}]`).querySelector(".order-item-quantity-text").innerText=o[g],f()):(o[g]=1,(()=>{console.log("ADDED"),d+=v;const r=a("background-blur");r.dataset.id=g,r.dataset.price=v,r.innerHTML=`\n                <div class="order-item">\n                    <div class="order-item-content">\n                        <img src="${b}" alt="">\n                        <div class="order-item-content-info">\n                            <p class="order-item-text">${p}</p>\n                            <p class="order-item-content-price">$${v}</p>\n                        </div>\n                    </div>\n                    <div class="order-item-quantity">\n                        <p class="order-item-text">QUANTITY</p>\n                        <p class="order-item-quantity-text">${o[g]}</p>\n                    </div>\n                </div>\n                <button class="order-remove">REMOVE</button>\n                `,n.appendChild(r),f(),(()=>{const a=r.querySelector(".order-remove"),i=((()=>{const e=r.querySelector(".order-item").classList;a.addEventListener("mouseenter",(()=>e.add("order-item-blurred"))),a.addEventListener("mouseleave",(()=>e.remove("order-item-blurred")))})(),()=>{a.classList.add("order-remove-visible"),console.log("visible")}),l=()=>{a.classList.remove("order-remove-visible"),console.log("invisible")};r.addEventListener("mouseenter",(()=>i())),r.addEventListener("focus",(()=>i())),r.addEventListener("mouseleave",(()=>l())),r.addEventListener("focusout",(()=>l())),a.addEventListener("click",(()=>{(a=>{const r=a.dataset.id;d-=a.dataset.price*o[r],delete o[r],n.removeChild(a),e.session.removeOrderItem(r),0==document.querySelectorAll(".order-item").length&&(s(t),c.orderEmpty())})(r)}))})()})())}}})(),c={menuBtns(){const e=document.querySelectorAll(".menu-item");n(e,"menu-item-active",(e=>{const n={HOME:r,MENU:d};s(t),n[e.id]()}))},homePage(){s(t),r()},orderEmpty(){const e=document.querySelector(".order-content"),t=a("order-content-empty");t.innerHTML='\n                <img src="images/order.svg" alt="">\n                <p class="order-empty-text">NO PRODUCTS ADDED</p>\n                ',e.appendChild(t)},date(){const e=document.getElementById("date-text"),t=()=>{let t=new Date,n=t.getMonth()+1;n<10&&(n="0"+n.toString());let s=t.getDate(),a=t.getFullYear(),r=t.getHours(),o=t.getMinutes();e.innerText=`${n}-${s}-${a}, ${r}:${o}`};t(),setInterval((()=>t()),1e3)}};return{load:c,orderAside:l}})();t.load.menuBtns(),t.load.homePage(),t.load.date(),t.load.orderEmpty(),e.session.loadOrderItemList()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUM3QixFQUVBLElBQUFjLEdBQ0ksTUFBTUMsRUFBUy9HLFNBQVNzQyxlQUFlLGFBQ2pDMEUsRUFBYyxLQUNoQixJQUFJRixFQUFPLElBQUlHLEtBQ1hDLEVBQVFKLEVBQUtLLFdBQWEsRUFDMUJELEVBQVEsS0FBSUEsRUFBUSxJQUFNQSxFQUFNRSxZQUNwQyxJQUFJQyxFQUFNUCxFQUFLUSxVQUNYQyxFQUFPVCxFQUFLVSxjQUNaQyxFQUFLWCxFQUFLWSxXQUNWQyxFQUFLYixFQUFLYyxhQUNkYixFQUFPbkYsVUFBWSxHQUFHc0YsS0FBU0csS0FBT0UsTUFBU0UsS0FBTUUsR0FBSSxFQUU3RFgsSUFDUWEsYUFBWSxJQUFNYixLQUFlLElBQzdDLEdBR0osTUFBTyxDQUFFakIsT0FBTTVGLGFBQ2xCLEVBaGNVLEdDQ1gsRUFBRzRGLEtBQUtXLFdBQ1IsRUFBR1gsS0FBS2MsV0FDUixFQUFHZCxLQUFLZSxPQUNSLEVBQUdmLEtBQUtDLGFBRVIsRUFBUXRILFFBQVFvQixtQiIsInNvdXJjZXMiOlsid2VicGFjazovL3Jlc3RhdXJhbnQtcGFnZS8uL3NyYy9zdG9yYWdlLmpzIiwid2VicGFjazovL3Jlc3RhdXJhbnQtcGFnZS8uL3NyYy9VSS5qcyIsIndlYnBhY2s6Ly9yZXN0YXVyYW50LXBhZ2UvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFVJIGZyb20gXCIuL1VJXCI7XG5jb25zdCBzdG9yYWdlID0gKCgpID0+IHtcbiAgICAvL3Byb3ZpZGVkIGJ5IG1kbiBkb2NzXG4gICAgZnVuY3Rpb24gc3RvcmFnZUF2YWlsYWJsZSh0eXBlKSB7XG4gICAgICAgIGxldCBzdG9yYWdlO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgc3RvcmFnZSA9IHdpbmRvd1t0eXBlXTtcbiAgICAgICAgICAgIGNvbnN0IHggPSBcIl9fc3RvcmFnZV90ZXN0X19cIjtcbiAgICAgICAgICAgIHN0b3JhZ2Uuc2V0SXRlbSh4LCB4KTtcbiAgICAgICAgICAgIHN0b3JhZ2UucmVtb3ZlSXRlbSh4KTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgIGUgaW5zdGFuY2VvZiBET01FeGNlcHRpb24gJiZcbiAgICAgICAgICAgICAgICAvLyBldmVyeXRoaW5nIGV4Y2VwdCBGaXJlZm94XG4gICAgICAgICAgICAgICAgKGUuY29kZSA9PT0gMjIgfHxcbiAgICAgICAgICAgICAgICAgICAgLy8gRmlyZWZveFxuICAgICAgICAgICAgICAgICAgICBlLmNvZGUgPT09IDEwMTQgfHxcbiAgICAgICAgICAgICAgICAgICAgLy8gdGVzdCBuYW1lIGZpZWxkIHRvbywgYmVjYXVzZSBjb2RlIG1pZ2h0IG5vdCBiZSBwcmVzZW50XG4gICAgICAgICAgICAgICAgICAgIC8vIGV2ZXJ5dGhpbmcgZXhjZXB0IEZpcmVmb3hcbiAgICAgICAgICAgICAgICAgICAgZS5uYW1lID09PSBcIlF1b3RhRXhjZWVkZWRFcnJvclwiIHx8XG4gICAgICAgICAgICAgICAgICAgIC8vIEZpcmVmb3hcbiAgICAgICAgICAgICAgICAgICAgZS5uYW1lID09PSBcIk5TX0VSUk9SX0RPTV9RVU9UQV9SRUFDSEVEXCIpICYmXG4gICAgICAgICAgICAgICAgLy8gYWNrbm93bGVkZ2UgUXVvdGFFeGNlZWRlZEVycm9yIG9ubHkgaWYgdGhlcmUncyBzb21ldGhpbmcgYWxyZWFkeSBzdG9yZWRcbiAgICAgICAgICAgICAgICBzdG9yYWdlICYmXG4gICAgICAgICAgICAgICAgc3RvcmFnZS5sZW5ndGggIT09IDBcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3Qgc2Vzc2lvbiA9ICgoKSA9PiB7XG4gICAgICAgIGNvbnN0IHNhdmVkT3JkZXJJdGVtTGlzdCA9IEpTT04ucGFyc2Uoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnb3JkZXJJdGVtTGlzdCcpKTtcbiAgICAgICAgbGV0IG9yZGVySXRlbUxpc3QgPSBzYXZlZE9yZGVySXRlbUxpc3QgPyBzYXZlZE9yZGVySXRlbUxpc3QgOiBbXTtcblxuICAgICAgICBjb25zdCBsb2cgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc3RhcnRpbmcgbG9nLi4nKTtcbiAgICAgICAgICAgIGlmKG9yZGVySXRlbUxpc3QubGVuZ3RoPjApe1xuXG4gICAgICAgICAgICAgICAgb3JkZXJJdGVtTGlzdC5mb3JFYWNoKChsaXN0SXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpZCA9IGxpc3RJdGVtLm1hdGNoKC9kYXRhLW1lbnUtaXRlbT1cIihbXlwiXSspXCIvKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coaWRbMV0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBjb25zb2xlLmxvZygnZW1wdHknKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhZGRPcmRlckl0ZW0gPSAoaXRlbSkgPT4ge1xuICAgICAgICAgICAgaWYgKHN0b3JhZ2VBdmFpbGFibGUoXCJzZXNzaW9uU3RvcmFnZVwiKSkge1xuICAgICAgICAgICAgICAgIG9yZGVySXRlbUxpc3QucHVzaChpdGVtLm91dGVySFRNTCk7XG4gICAgICAgICAgICAgICAgdXBkYXRlT3JkZXJJdGVtTGlzdChvcmRlckl0ZW1MaXN0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCByZW1vdmVPcmRlckl0ZW0gPSAodGFyZ2V0SWQpID0+IHtcbiAgICAgICAgICAgIGlmIChzdG9yYWdlQXZhaWxhYmxlKCdzZXNzaW9uU3RvcmFnZScpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3T3JkZXJlZEl0ZW1MaXN0ID0gb3JkZXJJdGVtTGlzdC5maWx0ZXIoaXRlbSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1JZCA9IGl0ZW0ubWF0Y2goL2RhdGEtbWVudS1pdGVtPVwiKFteXCJdKylcIi8pWzFdO1xuICAgICAgICAgICAgICAgICAgICBpZih0YXJnZXRJZCE9aXRlbUlkKSByZXR1cm4gaXRlbTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB1cGRhdGVPcmRlckl0ZW1MaXN0KG5ld09yZGVyZWRJdGVtTGlzdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVtb3ZlQWxsT3JkZXJJdGVtcyA9ICgpID0+IHtcbiAgICAgICAgICAgIG9yZGVySXRlbUxpc3QgPSBbXTtcbiAgICAgICAgICAgIHVwZGF0ZU9yZGVySXRlbUxpc3QoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCB1cGRhdGVPcmRlckl0ZW1MaXN0ID0gKGxpc3QpID0+IHtcbiAgICAgICAgICAgIG9yZGVySXRlbUxpc3QgPSBsaXN0O1xuICAgICAgICAgICAgaWYobGlzdCAmJiBsaXN0Lmxlbmd0aD4wKXtcbiAgICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdvcmRlckl0ZW1MaXN0JywgXG4gICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkobGlzdCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdvcmRlckl0ZW1MaXN0JywgXG4gICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkoW10pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBsb2FkT3JkZXJJdGVtTGlzdCA9ICgpID0+IHtcbiAgICAgICAgICAgIGlmIChzdG9yYWdlQXZhaWxhYmxlKCdzZXNzaW9uU3RvcmFnZScpKSB7XG4gICAgICAgICAgICAgICAgLy8gY29uc3QgaXRlbUxpc3QgPSBKU09OLnBhcnNlKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ29yZGVySXRlbUxpc3QnKSk7XG4gICAgICAgICAgICAgICAgaWYob3JkZXJJdGVtTGlzdCAhPSBudWxsICYmIG9yZGVySXRlbUxpc3QgIT0gW10pe1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaXRlbSBvZiBvcmRlckl0ZW1MaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZm9vZENhcmRDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb29kQ2FyZENvbnRhaW5lci5pbm5lckhUTUwgPSBpdGVtO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVJLm9yZGVyQXNpZGUubG9hZE9yZGVyKGZvb2RDYXJkQ29udGFpbmVyLmZpcnN0Q2hpbGQsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4geyBhZGRPcmRlckl0ZW0sIHJlbW92ZU9yZGVySXRlbSwgcmVtb3ZlQWxsT3JkZXJJdGVtcywgbG9hZE9yZGVySXRlbUxpc3QgfTtcbiAgICB9KSgpO1xuICAgIHJldHVybiB7IHNlc3Npb24gfTtcbn0pKCk7XG5leHBvcnQgZGVmYXVsdCBzdG9yYWdlOyIsImltcG9ydCBzdG9yYWdlIGZyb20gXCIuL3N0b3JhZ2VcIjtcblxuY29uc3QgVUkgPSAoKCkgPT4ge1xuICAgIGNvbnN0IGNvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udGVudCcpO1xuXG4gICAgY29uc3QgYnV0dG9uc1RvZ2dsZSA9IChub2RlbGlzdCwgdG9nZ2xlQ2xhc3MsIGFkZGl0aW9uYWxGdW5jdGlvbikgPT4ge1xuICAgICAgICBjb25zdCBsaXN0ID0gQXJyYXkuZnJvbShub2RlbGlzdCk7IC8vIGZvciBzb21lIHJlYXNvbiBJIG5lZWQgdG8gY29udmVydCB0aGUgbm9kZWxpc3QgaW50byBhbiBhcnJheSB3aXRoaW4gdGhlIGZ1bmN0aW9uIGl0c2VsZlxuICAgICAgICBsaXN0LmZvckVhY2goaXRlbSA9PiBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgbGlzdC5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5jbGFzc0xpc3QucmVtb3ZlKHRvZ2dsZUNsYXNzKSk7XG4gICAgICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQodG9nZ2xlQ2xhc3MpO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBhZGRpdGlvbmFsRnVuY3Rpb24gIT09ICd1bmRlZmluZWQnKSBhZGRpdGlvbmFsRnVuY3Rpb24oaXRlbSk7XG4gICAgICAgIH0pKTtcbiAgICB9O1xuXG4gICAgY29uc3QgY2xlYXIgPSAoZWxlbWVudCkgPT4ge1xuICAgICAgICB3aGlsZSAoZWxlbWVudC5sYXN0Q2hpbGQpIHtcbiAgICAgICAgICAgIGVsZW1lbnQubGFzdENoaWxkLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IGNyZWF0ZURpdiA9IChkaXZDbGFzcykgPT4ge1xuICAgICAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgZGl2LmNsYXNzTGlzdC5hZGQoZGl2Q2xhc3MpO1xuICAgICAgICByZXR1cm4gZGl2O1xuICAgIH07XG5cbiAgICBjb25zdCBob21lID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBsb2FkTmFtZVRvcCA9ICgpID0+IHtcbiAgICAgICAgICAgIG5hbWVUb3AuaW5uZXJIVE1MID1cbiAgICAgICAgICAgICAgICBgPHA+VEFCTEUgTElTVDwvcD5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJidXR0b25zXCI+XG4gICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwiZmxvb3ItYnRuIGZsb29yLTEgZmxvb3ItYnRuLWNsaWNrZWRcIj5GaXJzdCBGbG9vcjwvYnV0dG9uPlxuICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImZsb29yLWJ0biBmbG9vci0yXCI+U2Vjb25kIEZsb29yPC9idXR0b24+XG4gICAgICAgICAgICA8L2Rpdj5gO1xuICAgICAgICAgICAgY29udGVudC5hcHBlbmRDaGlsZChuYW1lVG9wKTtcblxuICAgICAgICAgICAgY29uc3Qgc3RhcnRMb2FkaW5nVGFibGVzID0gKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBmbG9vciA9IGl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCdmbG9vci0xJykgPyAwIDogNjtcbiAgICAgICAgICAgICAgICBsb2FkVGFibGVzKGZsb29yKVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgYnV0dG9uc1RvZ2dsZShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZmxvb3ItYnRuJyksICdmbG9vci1idG4tY2xpY2tlZCcsIHN0YXJ0TG9hZGluZ1RhYmxlcyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgbG9hZFRhYmxlSWQgPSAodGFibGVJZCkgPT4ge1xuICAgICAgICAgICAgaWYodHlwZW9mIHRhYmxlSWQgPT09ICd1bmRlZmluZWQnKXtcbiAgICAgICAgICAgICAgICBjb25zdCBzYXZlZFRhYmxlSWQgPSBKU09OLnBhcnNlKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3RhYmxlSWQnKSk7XG4gICAgICAgICAgICAgICAgdGFibGVJZCA9IHNhdmVkVGFibGVJZCA/IHNhdmVkVGFibGVJZCA6IFwibm90IHNlbGVjdGVkXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGFibGUtc2VsZWN0aW9uJykuaW5uZXJUZXh0ID0gdGFibGVJZDtcbiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50YWJsZS1vcmRlcicpLmlubmVyVGV4dCA9IHRhYmxlSWQ7XG5cbiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3RhYmxlSWQnLCB0YWJsZUlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGxvYWRUYWJsZXMgPSAoZmxvb3IpID0+IHtcbiAgICAgICAgICAgIGNsZWFyKHRhYmxlcylcbiAgICAgICAgICAgIHRhYmxlcy5pbm5lckhUTUwgPVxuICAgICAgICAgICAgICAgIGA8ZGl2IGNsYXNzPVwidGFibGVcIj5cbiAgICAgICAgICAgICAgICA8aW1nIGNsYXNzPVwicmVzdGF1cmFudC10YWJsZSB0YWJsZS0keysrZmxvb3J9XCIgc3JjPVwiLi9pbWFnZXMvdGFibGUuc3ZnXCIgYWx0PVwiSW1hZ2Ugb2YgYSByZXN0YXVyYW50IHRhYmxlXCI+XG4gICAgICAgICAgICAgICAgPHAgY2xhc3M9XCJyZXN0YXVyYW50LXRleHRcIj5UJHtmbG9vcn08L3A+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0YWJsZVwiPlxuICAgICAgICAgICAgICAgIDxpbWcgY2xhc3M9XCJyZXN0YXVyYW50LXRhYmxlIHRhYmxlLSR7KytmbG9vcn1cIiBzcmM9XCIuL2ltYWdlcy90YWJsZS5zdmdcIiBhbHQ9XCJJbWFnZSBvZiBhIHJlc3RhdXJhbnQgdGFibGVcIj5cbiAgICAgICAgICAgICAgICA8cCBjbGFzcz1cInJlc3RhdXJhbnQtdGV4dFwiPlQke2Zsb29yfTwvcD5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInRhYmxlXCI+XG4gICAgICAgICAgICAgICAgPGltZyBjbGFzcz1cInJlc3RhdXJhbnQtdGFibGUgdGFibGUtJHsrK2Zsb29yfVwiIHNyYz1cIi4vaW1hZ2VzL3RhYmxlLnN2Z1wiIGFsdD1cIkltYWdlIG9mIGEgcmVzdGF1cmFudCB0YWJsZVwiPlxuICAgICAgICAgICAgICAgIDxwIGNsYXNzPVwicmVzdGF1cmFudC10ZXh0XCI+VCR7Zmxvb3J9PC9wPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwidGFibGVcIj5cbiAgICAgICAgICAgICAgICA8aW1nIGNsYXNzPVwicmVzdGF1cmFudC10YWJsZSB0YWJsZS0keysrZmxvb3J9XCIgc3JjPVwiLi9pbWFnZXMvdGFibGUuc3ZnXCIgYWx0PVwiSW1hZ2Ugb2YgYSByZXN0YXVyYW50IHRhYmxlXCI+XG4gICAgICAgICAgICAgICAgPHAgY2xhc3M9XCJyZXN0YXVyYW50LXRleHRcIj5UJHtmbG9vcn08L3A+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0YWJsZVwiPlxuICAgICAgICAgICAgICAgIDxpbWcgY2xhc3M9XCJyZXN0YXVyYW50LXRhYmxlIHRhYmxlLSR7KytmbG9vcn1cIiBzcmM9XCIuL2ltYWdlcy90YWJsZS5zdmdcIiBhbHQ9XCJJbWFnZSBvZiBhIHJlc3RhdXJhbnQgdGFibGVcIj5cbiAgICAgICAgICAgICAgICA8cCBjbGFzcz1cInJlc3RhdXJhbnQtdGV4dFwiPlQke2Zsb29yfTwvcD5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInRhYmxlXCI+XG4gICAgICAgICAgICAgICAgPGltZyBjbGFzcz1cInJlc3RhdXJhbnQtdGFibGUgdGFibGUtJHsrK2Zsb29yfVwiIHNyYz1cIi4vaW1hZ2VzL3RhYmxlLnN2Z1wiIGFsdD1cIkltYWdlIG9mIGEgcmVzdGF1cmFudCB0YWJsZVwiPlxuICAgICAgICAgICAgICAgIDxwIGNsYXNzPVwicmVzdGF1cmFudC10ZXh0XCI+VCR7Zmxvb3J9PC9wPlxuICAgICAgICAgICAgPC9kaXY+YDtcbiAgICAgICAgICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQodGFibGVzKTtcbiAgICAgICAgICAgIGxvYWRTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IHNldFRhYmxlSWQgPSAoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRhYmxlSWQgPSBpdGVtLmNsYXNzTGlzdFsxXS5zcGxpdCgnLScpWzFdO1xuICAgICAgICAgICAgICAgIGxvYWRUYWJsZUlkKHRhYmxlSWQpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGJ1dHRvbnNUb2dnbGUoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnJlc3RhdXJhbnQtdGFibGUnKSwgJ3RhYmxlLWNsaWNrZWQnLCBzZXRUYWJsZUlkKTtcbiAgICAgICAgICAgIFxuICAgICAgICB9O1xuXG5cbiAgICAgICAgY29uc3QgbG9hZFNlbGVjdGlvbiA9ICh0YWJsZUlkKSA9PiB7XG4gICAgICAgICAgICBjbGVhcihzZWxlY3Rpb24pO1xuICAgICAgICAgICAgc2VsZWN0aW9uLmlubmVySFRNTCA9XG4gICAgICAgICAgICAgICAgYDxkaXYgY2xhc3M9XCJvcmRlci1pY29uc1wiPlxuICAgICAgICAgICAgICAgIDxpbWcgY2xhc3M9XCJ0YWJsZS1pbWFnZVwiIHNyYz1cIi4vaW1hZ2VzL3NtYWxsIHRhYmxlIGljb24uc3ZnXCIgYWx0PVwiXCI+XG4gICAgICAgICAgICAgICAgPHAgY2xhc3M9XCJ0YWJsZS10ZXh0XCI+VEFCTEU6PC9wPlxuICAgICAgICAgICAgICAgIDxwIGNsYXNzPVwidGFibGUtY291bnQgdGFibGUtc2VsZWN0aW9uXCI+PC9wPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8YnV0dG9uIGlkPVwic2VsZWN0aW9uLWJ0blwiPlNFTEVDVCBBTkQgQ09OVElOVUU8L2J1dHRvbj5gXG4gICAgICAgICAgICBjb250ZW50LmFwcGVuZENoaWxkKHNlbGVjdGlvbik7XG4gICAgICAgICAgICBsb2FkVGFibGVJZCh0YWJsZUlkKTtcbiAgICAgICAgICAgIHNlbGVjdGlvbkJ0bkNsaWNrZWQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBzZWxlY3Rpb25CdG5DbGlja2VkID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzZWxlY3Rpb24tYnRuXCIpO1xuICAgICAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRhYmxlSWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGFibGUtc2VsZWN0aW9uJykuaW5uZXJUZXh0O1xuICAgICAgICAgICAgICAgIGlmICh0YWJsZUlkID09ICdub3Qgc2VsZWN0ZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KCdTZWxlY3QgYSB0YWJsZS4nKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnTUVOVScpLmNsaWNrKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBjbGVhcihjb250ZW50KTtcblxuICAgICAgICBjb25zdCBuYW1lVG9wID0gY3JlYXRlRGl2KCduYW1lLXRvcCcpO1xuICAgICAgICBsb2FkTmFtZVRvcCgpO1xuXG4gICAgICAgIGNvbnN0IHRhYmxlcyA9IGNyZWF0ZURpdigndGFibGVzJyk7XG4gICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IGNyZWF0ZURpdignc2VsZWN0aW9uJyk7XG4gICAgICAgIGxvYWRUYWJsZXMoMCk7XG4gICAgfTtcblxuICAgIGNvbnN0IG1lbnVPYmplY3RGYWN0b3J5ID0gKG9sZE5hbWUsIGNhdGVnb3J5LCBzcGljaW5lc3MsIGltZ0xpbmssIHByaWNlKSA9PiB7XG4gICAgICAgIGxldCBuYW1lID0gb2xkTmFtZS50b1VwcGVyQ2FzZSgpO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgY2F0ZWdvcnksXG4gICAgICAgICAgICBzcGljaW5lc3MsXG4gICAgICAgICAgICBpbWdMaW5rLFxuICAgICAgICAgICAgcHJpY2VcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgLy8gY29uc3QgbWVudXNMaXN0ID0gbWVudU9iamVjdDsgLSBBbiBvYmplY3Qgc2F2ZWQgaW4gbG9jYWxTdG9yYWdlXG4gICAgY29uc3QgbWVudXNMaXN0ID0ge1xuICAgICAgICBcIlNUQVJURVJcIjoge1xuICAgICAgICAgICAgaXRlbTE6IG1lbnVPYmplY3RGYWN0b3J5KFwiY2hpY2tlbiB3aW5nc1wiLCBcIk5cIiwgMiwgXCIuL2ltYWdlcy9jaGlja2VuV2luZy5qcGdcIiwgMjMpLFxuICAgICAgICAgICAgaXRlbTI6IG1lbnVPYmplY3RGYWN0b3J5KFwiZnJlbmNoIGZyaWVzXCIsIFwiR1wiLCAwLCBcIi4vaW1hZ2VzL2ZyZW5jaEZyeS5qcGdcIiwgMjMpLFxuICAgICAgICAgICAgaXRlbTM6IG1lbnVPYmplY3RGYWN0b3J5KFwiZ2xhc3MgbWVhdFwiLCBcIkdcIiwgMiwgXCIuL2ltYWdlcy9nbGFzc01lYXQuanBnXCIsIDIzKSxcbiAgICAgICAgICAgIGl0ZW00OiBtZW51T2JqZWN0RmFjdG9yeShcImdsYXNzIG1lYXRcIiwgXCJHXCIsIDEsIFwiLi9pbWFnZXMvaWRrQnJlYWQuanBnXCIsIDIzKSxcbiAgICAgICAgICAgIGl0ZW01OiBtZW51T2JqZWN0RmFjdG9yeShcInN1bW1lciBzYWxhZFwiLCBcIk5cIiwgMSwgXCIuL2ltYWdlcy9zdW1tZXJTYWxhZC5qcGdcIiwgMjMpLFxuICAgICAgICAgICAgaXRlbTc6IG1lbnVPYmplY3RGYWN0b3J5KFwic3VtbWVyIHNhbGFkXCIsIFwiMCVcIiwgMSwgXCIuL2ltYWdlcy9zdW1tZXJTYWxhZC5qcGdcIiwgMjMpLFxuICAgICAgICAgICAgaXRlbTY6IG1lbnVPYmplY3RGYWN0b3J5KFwiY2hpY2tlbiB3aW5nc1wiLCBcIkdcIiwgMiwgXCIuL2ltYWdlcy9pZGtCcmVhZC5qcGdcIiwgMTkpXG4gICAgICAgIH0sXG4gICAgICAgIFwiTUFJTiBDT1VSU0VcIjoge1xuICAgICAgICAgICAgaXRlbTg6IG1lbnVPYmplY3RGYWN0b3J5KFwic3VtbWVyIHNhbGFkXCIsIFwiTlwiLCAxLCBcIi4vaW1hZ2VzL3N1bW1lclNhbGFkLmpwZ1wiLCAyMyksXG4gICAgICAgICAgICBpdGVtOTogbWVudU9iamVjdEZhY3RvcnkoXCJzdW1tZXIgc2FsYWRcIiwgXCIwJVwiLCAxLCBcIi4vaW1hZ2VzL3N1bW1lclNhbGFkLmpwZ1wiLCAyMyksXG4gICAgICAgICAgICBpdGVtMTA6IG1lbnVPYmplY3RGYWN0b3J5KFwiY2hpY2tlbiB3aW5nc1wiLCBcIkdcIiwgMiwgXCIuL2ltYWdlcy9pZGtCcmVhZC5qcGdcIiwgMjMpXG4gICAgICAgIH0sXG4gICAgICAgIFwiRFJJTktTXCI6IHtcbiAgICAgICAgICAgIGl0ZW0xMTogbWVudU9iamVjdEZhY3RvcnkoXCJicmVhZFwiLCBcIkdcIiwgMiwgXCIuL2ltYWdlcy9pa0JyZWFkLmpwZ1wiLCAyMyksXG4gICAgICAgICAgICBpdGVtMTI6IG1lbnVPYmplY3RGYWN0b3J5KFwiZ2xhc3MgbWVhdFwiLCBcIkdcIiwgMiwgXCIuL2ltYWdlcy9nbGFzc01lYXQuanBnXCIsIDIzKSxcbiAgICAgICAgICAgIGl0ZW0xMzogbWVudU9iamVjdEZhY3RvcnkoXCJzdW1tZXIgc2FsYWRcIiwgXCJOXCIsIDEsIFwiLi9pbWFnZXMvc3VtbWVyU2FsYWQuanBnXCIsIDIzKSxcbiAgICAgICAgICAgIGl0ZW0xNDogbWVudU9iamVjdEZhY3RvcnkoXCJzdW1tZXIgc2FsYWRcIiwgXCIwJVwiLCAxLCBcIi4vaW1hZ2VzL3N1bW1lclNhbGFkLmpwZ1wiLCAyMyksXG4gICAgICAgICAgICBpdGVtMTU6IG1lbnVPYmplY3RGYWN0b3J5KFwiY2hpY2tlbiB3aW5nc1wiLCBcIkdcIiwgMiwgXCIuL2ltYWdlcy9pZGtCcmVhZC5qcGdcIiwgMjMpLFxuICAgICAgICB9LFxuICAgICAgICBcIkRFU1NFUlRTXCI6IHtcbiAgICAgICAgICAgIGl0ZW04OiBtZW51T2JqZWN0RmFjdG9yeShcImdsYXNzIG1lYXRcIiwgXCJHXCIsIDIsIFwiLi9pbWFnZXMvZ2xhc3NNZWF0LmpwZ1wiLCAyMyksXG4gICAgICAgICAgICBpdGVtOTogbWVudU9iamVjdEZhY3RvcnkoXCJnbGFzcyBtZWF0XCIsIFwiR1wiLCAxLCBcIi4vaW1hZ2VzL2lka0JyZWFkLmpwZ1wiLCAyMyksXG4gICAgICAgICAgICBpdGVtMzogbWVudU9iamVjdEZhY3RvcnkoXCJzdW1tZXIgc2FsYWRcIiwgXCJOXCIsIDEsIFwiLi9pbWFnZXMvc3VtbWVyU2FsYWQuanBnXCIsIDIzKSxcbiAgICAgICAgICAgIGl0ZW00OiBtZW51T2JqZWN0RmFjdG9yeShcInN1bW1lciBzYWxhZFwiLCBcIjAlXCIsIDEsIFwiLi9pbWFnZXMvc3VtbWVyU2FsYWQuanBnXCIsIDIzKSxcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IG1lbnUgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGxvYWRGb29kQ29udGVudCA9IChzZWxlY3RlZE1lbnVOYW1lID0gXCJTVEFSVEVSXCIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkTWVudSA9IG1lbnVzTGlzdFtzZWxlY3RlZE1lbnVOYW1lXTtcbiAgICAgICAgICAgIGZvciAobGV0IGl0ZW0gaW4gc2VsZWN0ZWRNZW51KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZm9vZEl0ZW1Db250YWluZXIgPSBjcmVhdGVEaXYoJ2Zvb2QtaXRlbS1jb250YWluZXInKTtcbiAgICAgICAgICAgICAgICBjb25zdCBtZW51SXRlbSA9IHNlbGVjdGVkTWVudVtpdGVtXTtcbiAgICAgICAgICAgICAgICBsZXQgc3BpY3lJY29ucyA9IGBgO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWVudUl0ZW0uc3BpY2luZXNzOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgc3BpY3lJY29ucyArPSBgPGltZyBzcmM9XCIuL2ltYWdlcy9jaGlsbGkuc3ZnXCI+YFxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGZvb2RJdGVtQ29udGFpbmVyLmlubmVySFRNTCA9XG4gICAgICAgICAgICAgICAgICAgIGA8ZGl2IGNsYXNzPVwiZm9vZC1jYXJkXCIgZGF0YS1tZW51LWxpc3Q9XCIke3NlbGVjdGVkTWVudU5hbWV9XCIgZGF0YS1tZW51LWl0ZW09XCIke2l0ZW19XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZm9vZC1pbWdcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW1nIHNyYz1cIiR7bWVudUl0ZW0uaW1nTGlua31cIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImZvb2QtaW5mb1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPVwiZm9vZC1uYW1lXCI+JHttZW51SXRlbS5uYW1lfTwvcD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZm9vZC1jYXRlZ29yeS1jb250YWluZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9XCJmb29kLWNhdGVnb3J5LXRleHRcIj5DQVRFR09SWTo8L3A+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJmb29kLWNhdGVnb3J5LWljb25zXCI+JHttZW51SXRlbS5jYXRlZ29yeX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtzcGljeUljb25zfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PmBcbiAgICAgICAgICAgICAgICBmb29kQ29udGVudC5hcHBlbmRDaGlsZChmb29kSXRlbUNvbnRhaW5lcik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGZvb2RDYXJkQ2xpY2tlZCA9ICgoKSA9PiB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZvb2QtY2FyZCcpXG4gICAgICAgICAgICAgICAgICAgIC5mb3JFYWNoKGNhcmQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FyZC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IG9yZGVyQXNpZGUubG9hZE9yZGVyKGNhcmQsIGZhbHNlKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBsb2FkRm9vZEZvb3RlciA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGZvb3RlckJ0bnMgPSBbXCJTVEFSVEVSXCIsIFwiTUFJTiBDT1VSU0VcIiwgXCJEUklOS1NcIiwgXCJERVNTRVJUU1wiXTtcbiAgICAgICAgICAgIGZvciAobGV0IGJ0biBpbiBmb290ZXJCdG5zKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZm9vdGVyQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gICAgICAgICAgICAgICAgZm9vdGVyQnRuLmNsYXNzTGlzdC5hZGQoJ2Zvb2QtZm9vdGVyLWJ0bicpO1xuICAgICAgICAgICAgICAgIGlmIChmb290ZXJCdG5zW2J0bl0gPT09IFwiU1RBUlRFUlwiKSBmb290ZXJCdG4uY2xhc3NMaXN0LmFkZCgnZm9vZC1mb290ZXItYnRuLWFjdGl2ZScpO1xuICAgICAgICAgICAgICAgIGZvb3RlckJ0bi5pbm5lclRleHQgPSBmb290ZXJCdG5zW2J0bl07XG4gICAgICAgICAgICAgICAgZm9vZEZvb3Rlci5hcHBlbmRDaGlsZChmb290ZXJCdG4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbG9hZFNlbGVjdGVkTWVudSA9IChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgY2xlYXIoZm9vZENvbnRlbnQpO1xuICAgICAgICAgICAgICAgIGxvYWRGb29kQ29udGVudChpdGVtLmlubmVyVGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBidXR0b25zVG9nZ2xlKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5mb29kLWZvb3Rlci1idG4nKSwgJ2Zvb2QtZm9vdGVyLWJ0bi1hY3RpdmUnLCBsb2FkU2VsZWN0ZWRNZW51KTtcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBmb29kQ29udGVudCA9IGNyZWF0ZURpdignZm9vZC1jb250ZW50Jyk7XG4gICAgICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQoZm9vZENvbnRlbnQpO1xuICAgICAgICBsb2FkRm9vZENvbnRlbnQoKTtcblxuICAgICAgICBjb25zdCBmb29kRm9vdGVyID0gY3JlYXRlRGl2KCdmb29kLWZvb3RlcicpO1xuICAgICAgICBjb250ZW50LmFwcGVuZENoaWxkKGZvb2RGb290ZXIpO1xuICAgICAgICBsb2FkRm9vZEZvb3RlcigpO1xuICAgIH07XG5cbiAgICBjb25zdCBvcmRlckFzaWRlID0gKCgpID0+IHtcbiAgICAgICAgY29uc3Qgb3JkZXJDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm9yZGVyLWNvbnRlbnQnKTtcbiAgICAgICAgY29uc3Qgb3JkZXJJdGVtcyA9IGNyZWF0ZURpdignb3JkZXItY29udGVudC1pdGVtcycpO1xuICAgICAgICBjb25zdCBvcmRlclByaWNlID0gY3JlYXRlRGl2KCdvcmRlci1jb250ZW50LXByaWNlJyk7XG5cbiAgICAgICAgbGV0IHF1YW50aXR5Q291bnQgPSB7fTtcbiAgICAgICAgbGV0IHRvdGFsUHJpY2UgPSAwO1xuXG4gICAgICAgIGNvbnN0IGxvYWRPcmRlciA9IChzZWxlY3RlZENhcmQsIGxvYWRlZEZyb21DYWNoZSkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRPYmogPSBtZW51c0xpc3Rbc2VsZWN0ZWRDYXJkLmRhdGFzZXQubWVudUxpc3RdW3NlbGVjdGVkQ2FyZC5kYXRhc2V0Lm1lbnVJdGVtXTtcbiAgICAgICAgICAgIGNvbnN0IGlkID0gc2VsZWN0ZWRDYXJkLmRhdGFzZXQubWVudUl0ZW07XG4gICAgICAgICAgICBjb25zdCBuYW1lID0gc2VsZWN0ZWRPYmoubmFtZTtcbiAgICAgICAgICAgIGNvbnN0IHByaWNlID0gc2VsZWN0ZWRPYmoucHJpY2U7XG4gICAgICAgICAgICBjb25zdCBpbWdMaW5rID0gc2VsZWN0ZWRPYmouaW1nTGluaztcblxuICAgICAgICAgICAgaWYgKCFsb2FkZWRGcm9tQ2FjaGUpIHtcbiAgICAgICAgICAgICAgICBzdG9yYWdlLnNlc3Npb24uYWRkT3JkZXJJdGVtKHNlbGVjdGVkQ2FyZCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcub3JkZXItY29udGVudC1lbXB0eScpKSB7XG4gICAgICAgICAgICAgICAgY2xlYXIob3JkZXJDb250ZW50KTtcbiAgICAgICAgICAgICAgICBvcmRlckNvbnRlbnQuYXBwZW5kQ2hpbGQob3JkZXJJdGVtcyk7XG4gICAgICAgICAgICAgICAgb3JkZXJDb250ZW50LmFwcGVuZENoaWxkKG9yZGVyUHJpY2UpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCByZW1vdmVPcmRlckl0ZW0gPSAoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1JZCA9IGl0ZW0uZGF0YXNldC5pZDtcbiAgICAgICAgICAgICAgICB0b3RhbFByaWNlIC09IGl0ZW0uZGF0YXNldC5wcmljZSAqIHF1YW50aXR5Q291bnRbaXRlbUlkXTtcbiAgICAgICAgICAgICAgICBkZWxldGUgcXVhbnRpdHlDb3VudFtpdGVtSWRdO1xuICAgICAgICAgICAgICAgIG9yZGVySXRlbXMucmVtb3ZlQ2hpbGQoaXRlbSk7XG4gICAgICAgICAgICAgICAgc3RvcmFnZS5zZXNzaW9uLnJlbW92ZU9yZGVySXRlbShpdGVtSWQpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5vcmRlci1pdGVtJykubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXIob3JkZXJDb250ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgbG9hZC5vcmRlckVtcHR5KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgbG9hZE9yZGVySXRlbSA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkFEREVEXCIpO1xuICAgICAgICAgICAgICAgIHRvdGFsUHJpY2UgKz0gcHJpY2U7XG4gICAgICAgICAgICAgICAgY29uc3Qgb3JkZXJJdGVtQmcgPSBjcmVhdGVEaXYoJ2JhY2tncm91bmQtYmx1cicpO1xuICAgICAgICAgICAgICAgIG9yZGVySXRlbUJnLmRhdGFzZXQuaWQgPSBpZDtcbiAgICAgICAgICAgICAgICBvcmRlckl0ZW1CZy5kYXRhc2V0LnByaWNlID0gcHJpY2U7XG4gICAgICAgICAgICAgICAgb3JkZXJJdGVtQmcuaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJvcmRlci1pdGVtXCI+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJvcmRlci1pdGVtLWNvbnRlbnRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxpbWcgc3JjPVwiJHtpbWdMaW5rfVwiIGFsdD1cIlwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm9yZGVyLWl0ZW0tY29udGVudC1pbmZvXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9XCJvcmRlci1pdGVtLXRleHRcIj4ke25hbWV9PC9wPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPVwib3JkZXItaXRlbS1jb250ZW50LXByaWNlXCI+JCR7cHJpY2V9PC9wPlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwib3JkZXItaXRlbS1xdWFudGl0eVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9XCJvcmRlci1pdGVtLXRleHRcIj5RVUFOVElUWTwvcD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPVwib3JkZXItaXRlbS1xdWFudGl0eS10ZXh0XCI+JHtxdWFudGl0eUNvdW50W2lkXX08L3A+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJvcmRlci1yZW1vdmVcIj5SRU1PVkU8L2J1dHRvbj5cbiAgICAgICAgICAgICAgICBgO1xuICAgICAgICAgICAgICAgIG9yZGVySXRlbXMuYXBwZW5kQ2hpbGQob3JkZXJJdGVtQmcpO1xuICAgICAgICAgICAgICAgIGxvYWRPcmRlclByaWNlKCk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBlbmFibGVSZW1vdkJ0bkVmZmVjdHMgPSAoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByZW1vdmVCdG4gPSBvcmRlckl0ZW1CZy5xdWVyeVNlbGVjdG9yKCcub3JkZXItcmVtb3ZlJyk7XG4gICAgICAgICAgICAgICAgICAgIC8vSSB3YXMgdW5hYmxlIHRvIGZpbmQgYSBjc3Mgc29sdXRpb24gZm9yIHRoZSBvcmRlckl0ZW0gdG8gYmUgYmx1cnJlZCB3aGVuIGhvdmVyaW5nIG92ZXIgdGhlIHJlbW92ZUJ0blxuICAgICAgICAgICAgICAgICAgICBjb25zdCBibHVyT3JkZXJJdGVtV2hpbGVIb3ZlcmluZ092ZXJSZW1vdmVCdG4gPSAoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3JkZXJJdGVtQ29udGVudENsYXNzbGlzdCA9IG9yZGVySXRlbUJnLnF1ZXJ5U2VsZWN0b3IoJy5vcmRlci1pdGVtJykuY2xhc3NMaXN0O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVCdG4uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsICgpID0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXJJdGVtQ29udGVudENsYXNzbGlzdC5hZGQoJ29yZGVyLWl0ZW0tYmx1cnJlZCcpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgKCkgPT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmRlckl0ZW1Db250ZW50Q2xhc3NsaXN0LnJlbW92ZSgnb3JkZXItaXRlbS1ibHVycmVkJykpO1xuICAgICAgICAgICAgICAgICAgICB9KSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJldmVhbFJlbW92ZUJ0biA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUJ0bi5jbGFzc0xpc3QuYWRkKCdvcmRlci1yZW1vdmUtdmlzaWJsZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJ2aXNpYmxlXCIpO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBoaWRlUmVtb3ZlQnRuID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQnRuLmNsYXNzTGlzdC5yZW1vdmUoJ29yZGVyLXJlbW92ZS12aXNpYmxlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImludmlzaWJsZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBvcmRlckl0ZW1CZy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgKCkgPT4gcmV2ZWFsUmVtb3ZlQnRuKCkpXG4gICAgICAgICAgICAgICAgICAgIG9yZGVySXRlbUJnLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgKCkgPT4gcmV2ZWFsUmVtb3ZlQnRuKCkpO1xuXG4gICAgICAgICAgICAgICAgICAgIG9yZGVySXRlbUJnLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCAoKSA9PiBoaWRlUmVtb3ZlQnRuKCkpO1xuICAgICAgICAgICAgICAgICAgICBvcmRlckl0ZW1CZy5hZGRFdmVudExpc3RlbmVyKCdmb2N1c291dCcsICgpID0+IGhpZGVSZW1vdmVCdG4oKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlT3JkZXJJdGVtKG9yZGVySXRlbUJnKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGNvbnN0IGxvYWRPcmRlclByaWNlID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHN1cmNoYXJnZSA9ICsoKHRvdGFsUHJpY2UgKiAwLjEpLnRvRml4ZWQoMikpO1xuICAgICAgICAgICAgICAgIG9yZGVyUHJpY2UuaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJvcmRlci1jb250ZW50LXByaWNlLWluZm9cIj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPVwib3JkZXItY29udGVudC1wcmljZS1pbmZvLXRleHRcIj5TVUJUT1RBTDwvcD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPVwib3JkZXItY29udGVudC1wcmljZS1pbmZvLXRleHRcIj4ke3RvdGFsUHJpY2V9PC9wPlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPVwib3JkZXItY29udGVudC1wcmljZS1pbmZvLXRleHRcIj5TRVJWSUNFIENIQVJHRSA8c3BhbiBjbGFzcz1cIm9yZGVyLWNvbnRlbnQtcHJpY2UtaW5mby1zdXJjaGFyZ2VcIj4xMCU8L3NwYW4+PC9wPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9XCJvcmRlci1jb250ZW50LXByaWNlLWluZm8tdGV4dFwiPiR7c3VyY2hhcmdlfTwvcD5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm9yZGVyLWNvbnRlbnQtcHJpY2UtaW50ZXJhY3RcIj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm9yZGVyLWNvbnRlbnQtcHJpY2UtaW50ZXJhY3QtaW5mb1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9XCJvcmRlci1jb250ZW50LXByaWNlLWludGVyYWN0LWluZm8tdGV4dFwiPlRPVEFMPC9wPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9XCJvcmRlci1jb250ZW50LXByaWNlLWludGVyYWN0LWluZm8tdGV4dFwiPiR7dG90YWxQcmljZSArIHN1cmNoYXJnZX08L3A+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwib3JkZXItY29udGVudC1wcmljZS1pbnRlcmFjdC1idXR0b25zXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwib3JkZXItY2FuY2VsXCI+Q0FOQ0VMIE9SREVSPC9idXR0b24+XG4gICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwib3JkZXItc2VuZFwiPlNFTkQgT1JERVI8L2J1dHRvbj5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgYDtcblxuICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5vcmRlci1jYW5jZWwnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXIob3JkZXJDb250ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXIob3JkZXJJdGVtcyk7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyKG9yZGVyUHJpY2UpO1xuICAgICAgICAgICAgICAgICAgICB0b3RhbFByaWNlID0gMDtcbiAgICAgICAgICAgICAgICAgICAgcXVhbnRpdHlDb3VudCA9IHt9O1xuICAgICAgICAgICAgICAgICAgICBsb2FkLm9yZGVyRW1wdHkoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJjbGVhcmVkXCIpO1xuICAgICAgICAgICAgICAgICAgICBzdG9yYWdlLnNlc3Npb24ucmVtb3ZlQWxsT3JkZXJJdGVtcygpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKCEocXVhbnRpdHlDb3VudFtpZF0pKSB7XG4gICAgICAgICAgICAgICAgcXVhbnRpdHlDb3VudFtpZF0gPSAxO1xuICAgICAgICAgICAgICAgIGxvYWRPcmRlckl0ZW0oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHF1YW50aXR5Q291bnRbaWRdKys7XG4gICAgICAgICAgICAgICAgdG90YWxQcmljZSArPSBwcmljZTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS1pZD0ke3NlbGVjdGVkQ2FyZC5kYXRhc2V0Lm1lbnVJdGVtfV1gKVxuICAgICAgICAgICAgICAgICAgICAucXVlcnlTZWxlY3RvcignLm9yZGVyLWl0ZW0tcXVhbnRpdHktdGV4dCcpLmlubmVyVGV4dCA9IHF1YW50aXR5Q291bnRbaWRdO1xuICAgICAgICAgICAgICAgIGxvYWRPcmRlclByaWNlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7IGxvYWRPcmRlciB9XG4gICAgfSkoKTtcblxuICAgIC8vIFRPIEJFIENPTlRJTlVFRCAgICBcblxuICAgIC8vIGNvbnN0IHBheW1lbnQgPSAoKSA9PiB7XG4gICAgLy8gICAgIGNvbnRlbnQuaW5uZXJUZXh0ID0gJ3BheW1lbnQ6KSdcbiAgICAvLyB9O1xuXG4gICAgLy8gY29uc3Qgb3JkZXJzID0gKCkgPT4ge1xuICAgIC8vICAgICBjb250ZW50LmlubmVyVGV4dCA9ICdvcmRlcnM6KSdcbiAgICAvLyB9XG5cbiAgICAvLyBjb25zdCBzZXR0aW5ncyA9ICgpID0+IHtcbiAgICAvLyAgICAgY29udGVudC5pbm5lclRleHQgPSAnc2V0dGluZ3M6KSdcbiAgICAvLyB9XG5cbiAgICBjb25zdCBsb2FkID0ge1xuICAgICAgICBtZW51QnRucygpIHtcbiAgICAgICAgICAgIGNvbnN0IG1lbnVBcnJheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5tZW51LWl0ZW0nKTtcbiAgICAgICAgICAgIGNvbnN0IGxvYWRTZWxlY3RlZE1lbnUgPSAoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZ1bmN0aW9uTWFwID0ge1xuICAgICAgICAgICAgICAgICAgICBcIkhPTUVcIjogaG9tZSxcbiAgICAgICAgICAgICAgICAgICAgXCJNRU5VXCI6IG1lbnUsXG4gICAgICAgICAgICAgICAgICAgIC8vIFwiUEFZTUVOVFwiOiBwYXltZW50LFxuICAgICAgICAgICAgICAgICAgICAvLyBcIk9SREVSU1wiOiBvcmRlcnMsXG4gICAgICAgICAgICAgICAgICAgIC8vIFwiU0VUVElOR1NcIjogc2V0dGluZ3NcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2xlYXIoY29udGVudClcbiAgICAgICAgICAgICAgICBmdW5jdGlvbk1hcFtpdGVtLmlkXSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnV0dG9uc1RvZ2dsZShtZW51QXJyYXksICdtZW51LWl0ZW0tYWN0aXZlJywgbG9hZFNlbGVjdGVkTWVudSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaG9tZVBhZ2UoKSB7XG4gICAgICAgICAgICBjbGVhcihjb250ZW50KTtcbiAgICAgICAgICAgIGhvbWUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvcmRlckVtcHR5KCkge1xuICAgICAgICAgICAgY29uc3Qgb3JkZXJDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm9yZGVyLWNvbnRlbnQnKVxuICAgICAgICAgICAgY29uc3Qgb3JkZXJFbXB0eSA9IGNyZWF0ZURpdignb3JkZXItY29udGVudC1lbXB0eScpO1xuICAgICAgICAgICAgb3JkZXJFbXB0eS5pbm5lckhUTUwgPSBgXG4gICAgICAgICAgICAgICAgPGltZyBzcmM9XCJpbWFnZXMvb3JkZXIuc3ZnXCIgYWx0PVwiXCI+XG4gICAgICAgICAgICAgICAgPHAgY2xhc3M9XCJvcmRlci1lbXB0eS10ZXh0XCI+Tk8gUFJPRFVDVFMgQURERUQ8L3A+XG4gICAgICAgICAgICAgICAgYDtcbiAgICAgICAgICAgIG9yZGVyQ29udGVudC5hcHBlbmRDaGlsZChvcmRlckVtcHR5KTtcbiAgICAgICAgfSxcblxuICAgICAgICBkYXRlKCkge1xuICAgICAgICAgICAgY29uc3QgdGltZUlkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGUtdGV4dCcpO1xuICAgICAgICAgICAgY29uc3QgY3VycmVudFRpbWUgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgICAgIGxldCBtb250aCA9IGRhdGUuZ2V0TW9udGgoKSArIDE7XG4gICAgICAgICAgICAgICAgaWYgKG1vbnRoIDwgMTApIG1vbnRoID0gXCIwXCIgKyBtb250aC50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgIGxldCBkYXkgPSBkYXRlLmdldERhdGUoKTtcbiAgICAgICAgICAgICAgICBsZXQgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTtcbiAgICAgICAgICAgICAgICBsZXQgaGggPSBkYXRlLmdldEhvdXJzKCk7XG4gICAgICAgICAgICAgICAgbGV0IG1tID0gZGF0ZS5nZXRNaW51dGVzKCk7XG4gICAgICAgICAgICAgICAgdGltZUlkLmlubmVyVGV4dCA9IGAke21vbnRofS0ke2RheX0tJHt5ZWFyfSwgJHtoaH06JHttbX1gO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGN1cnJlbnRUaW1lKCk7XG4gICAgICAgICAgICBsZXQgdCA9IHNldEludGVydmFsKCgpID0+IGN1cnJlbnRUaW1lKCksIDEwMDApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgbG9hZCwgb3JkZXJBc2lkZSB9O1xufSkoKTtcblxuZXhwb3J0IGRlZmF1bHQgVUk7IiwiaW1wb3J0IFVJIGZyb20gJy4vVUkuanMnO1xuaW1wb3J0IHN0b3JhZ2UgZnJvbSAnLi9zdG9yYWdlLmpzJztcblxuVUkubG9hZC5tZW51QnRucygpO1xuVUkubG9hZC5ob21lUGFnZSgpO1xuVUkubG9hZC5kYXRlKCk7XG5VSS5sb2FkLm9yZGVyRW1wdHkoKTtcblxuc3RvcmFnZS5zZXNzaW9uLmxvYWRPcmRlckl0ZW1MaXN0KCk7Il0sIm5hbWVzIjpbInN0b3JhZ2VBdmFpbGFibGUiLCJ0eXBlIiwic3RvcmFnZSIsIndpbmRvdyIsIngiLCJzZXRJdGVtIiwicmVtb3ZlSXRlbSIsImUiLCJET01FeGNlcHRpb24iLCJjb2RlIiwibmFtZSIsImxlbmd0aCIsInNlc3Npb24iLCJvcmRlckl0ZW1MaXN0IiwiSlNPTiIsInBhcnNlIiwic2Vzc2lvblN0b3JhZ2UiLCJnZXRJdGVtIiwidXBkYXRlT3JkZXJJdGVtTGlzdCIsImxpc3QiLCJzdHJpbmdpZnkiLCJhZGRPcmRlckl0ZW0iLCJpdGVtIiwicHVzaCIsIm91dGVySFRNTCIsInJlbW92ZU9yZGVySXRlbSIsInRhcmdldElkIiwibmV3T3JkZXJlZEl0ZW1MaXN0IiwiZmlsdGVyIiwiaXRlbUlkIiwibWF0Y2giLCJyZW1vdmVBbGxPcmRlckl0ZW1zIiwibG9hZE9yZGVySXRlbUxpc3QiLCJmb29kQ2FyZENvbnRhaW5lciIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsIm9yZGVyQXNpZGUiLCJsb2FkT3JkZXIiLCJmaXJzdENoaWxkIiwiY29udGVudCIsInF1ZXJ5U2VsZWN0b3IiLCJidXR0b25zVG9nZ2xlIiwibm9kZWxpc3QiLCJ0b2dnbGVDbGFzcyIsImFkZGl0aW9uYWxGdW5jdGlvbiIsIkFycmF5IiwiZnJvbSIsImZvckVhY2giLCJhZGRFdmVudExpc3RlbmVyIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwiYWRkIiwiY2xlYXIiLCJlbGVtZW50IiwibGFzdENoaWxkIiwiY3JlYXRlRGl2IiwiZGl2Q2xhc3MiLCJkaXYiLCJob21lIiwibG9hZFRhYmxlSWQiLCJ0YWJsZUlkIiwiaW5uZXJUZXh0IiwibG9hZFRhYmxlcyIsImZsb29yIiwidGFibGVzIiwiYXBwZW5kQ2hpbGQiLCJsb2FkU2VsZWN0aW9uIiwicXVlcnlTZWxlY3RvckFsbCIsInNwbGl0Iiwic2VsZWN0aW9uIiwic2VsZWN0aW9uQnRuQ2xpY2tlZCIsImdldEVsZW1lbnRCeUlkIiwiY2xpY2siLCJhbGVydCIsIm5hbWVUb3AiLCJjb250YWlucyIsIm1lbnVPYmplY3RGYWN0b3J5Iiwib2xkTmFtZSIsImNhdGVnb3J5Iiwic3BpY2luZXNzIiwiaW1nTGluayIsInByaWNlIiwidG9VcHBlckNhc2UiLCJtZW51c0xpc3QiLCJpdGVtMSIsIml0ZW0yIiwiaXRlbTMiLCJpdGVtNCIsIml0ZW01IiwiaXRlbTciLCJpdGVtNiIsIml0ZW04IiwiaXRlbTkiLCJpdGVtMTAiLCJpdGVtMTEiLCJpdGVtMTIiLCJpdGVtMTMiLCJpdGVtMTQiLCJpdGVtMTUiLCJtZW51IiwibG9hZEZvb2RDb250ZW50Iiwic2VsZWN0ZWRNZW51TmFtZSIsInNlbGVjdGVkTWVudSIsImZvb2RJdGVtQ29udGFpbmVyIiwibWVudUl0ZW0iLCJzcGljeUljb25zIiwiaSIsImZvb2RDb250ZW50IiwiY2FyZCIsImZvb2RGb290ZXIiLCJmb290ZXJCdG5zIiwiYnRuIiwiZm9vdGVyQnRuIiwibG9hZEZvb2RGb290ZXIiLCJvcmRlckNvbnRlbnQiLCJvcmRlckl0ZW1zIiwib3JkZXJQcmljZSIsInF1YW50aXR5Q291bnQiLCJ0b3RhbFByaWNlIiwic2VsZWN0ZWRDYXJkIiwibG9hZGVkRnJvbUNhY2hlIiwic2VsZWN0ZWRPYmoiLCJkYXRhc2V0IiwibWVudUxpc3QiLCJpZCIsImxvYWRPcmRlclByaWNlIiwic3VyY2hhcmdlIiwidG9GaXhlZCIsImxvYWQiLCJvcmRlckVtcHR5IiwiY29uc29sZSIsImxvZyIsIm9yZGVySXRlbUJnIiwicmVtb3ZlQnRuIiwicmV2ZWFsUmVtb3ZlQnRuIiwib3JkZXJJdGVtQ29udGVudENsYXNzbGlzdCIsImhpZGVSZW1vdmVCdG4iLCJyZW1vdmVDaGlsZCIsImxvYWRPcmRlckl0ZW0iLCJtZW51QnRucyIsIm1lbnVBcnJheSIsImZ1bmN0aW9uTWFwIiwiaG9tZVBhZ2UiLCJkYXRlIiwidGltZUlkIiwiY3VycmVudFRpbWUiLCJEYXRlIiwibW9udGgiLCJnZXRNb250aCIsInRvU3RyaW5nIiwiZGF5IiwiZ2V0RGF0ZSIsInllYXIiLCJnZXRGdWxsWWVhciIsImhoIiwiZ2V0SG91cnMiLCJtbSIsImdldE1pbnV0ZXMiLCJzZXRJbnRlcnZhbCJdLCJzb3VyY2VSb290IjoiIn0=